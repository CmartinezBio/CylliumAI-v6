<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Impacto Ambiental</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/naitus-template.css">
    <link rel="stylesheet" href="css/naitus-guide.css">
    <link rel="stylesheet" href="css/main.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body#static {
            background-image: url(assets/video.mp4);
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            position: relative;
            font-family: 'Inter', sans-serif;
        }

        body {
            zoom: 70%;
        }

        body#static::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1;
        }

        .results-container {
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, rgba(23, 26, 39, 0.95), rgba(41, 45, 62, 0.9));
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            width: 95%;
            max-width: 1200px;
            margin: 20px auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(63, 207, 142, 0.2);
        }

        .page-title {
            text-align: center;
            color: #ffffff;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, #3fcf8e, #64d4a4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(63, 207, 142, 0.3);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 40px;
        }

        .result-card {
            background: linear-gradient(135deg, rgba(41, 45, 62, 0.9), rgba(53, 58, 79, 0.8));
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(63, 207, 142, 0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(63, 207, 142, 0.2);
            border-color: rgba(63, 207, 142, 0.6);
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3fcf8e, #64d4a4, #85e6c1);
            border-radius: 20px 20px 0 0;
        }

        .card-title {
            color: #ffffff;
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-icon {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #3fcf8e, #64d4a4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .impact-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #3fcf8e;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(63, 207, 142, 0.3);
        }

        .impact-subtitle {
            color: #a8b5c8;
            font-size: 0.9rem;
            font-weight: 400;
        }

        .eco-equivalences {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .equivalence-item {
            background: linear-gradient(135deg, rgba(63, 207, 142, 0.1), rgba(100, 212, 164, 0.05));
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(63, 207, 142, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .equivalence-item:hover {
            transform: scale(1.02);
            background: linear-gradient(135deg, rgba(63, 207, 142, 0.15), rgba(100, 212, 164, 0.08));
            border-color: rgba(63, 207, 142, 0.4);
        }

        .equivalence-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
        }

        .equivalence-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #3fcf8e;
            margin-bottom: 5px;
        }

        .equivalence-label {
            color: #a8b5c8;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .lifecycle-stages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .lifecycle-stage {
            background: linear-gradient(135deg, rgba(63, 207, 142, 0.08), rgba(100, 212, 164, 0.04));
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .lifecycle-stage:nth-child(1) { border-left-color: #3fcf8e; }
        .lifecycle-stage:nth-child(2) { border-left-color: #60a8d8; }
        .lifecycle-stage:nth-child(3) { border-left-color: #d8a860; }
        .lifecycle-stage:nth-child(4) { border-left-color: #d86060; }

        .lifecycle-stage:hover {
            transform: translateX(5px);
            background: linear-gradient(135deg, rgba(63, 207, 142, 0.12), rgba(100, 212, 164, 0.06));
        }

        .stage-title {
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .stage-value {
            color: #3fcf8e;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 25px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 20px;
        }

        .comparison-container {
            background: linear-gradient(135deg, rgba(216, 96, 96, 0.1), rgba(216, 96, 96, 0.05));
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(216, 96, 96, 0.3);
            margin-top: 20px;
        }

        .comparison-title {
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comparison-value {
            color: #d86060;
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .recommendations-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            background: linear-gradient(135deg, rgba(63, 207, 142, 0.05), rgba(100, 212, 164, 0.02));
            border-radius: 12px;
            padding: 15px;
            border-left: 3px solid #3fcf8e;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            background: linear-gradient(135deg, rgba(63, 207, 142, 0.1), rgba(100, 212, 164, 0.05));
            transform: translateX(3px);
        }

        .rec-icon {
            font-size: 1.5rem;
            min-width: 30px;
            text-align: center;
        }

        .rec-content {
            flex: 1;
        }

        .rec-content strong {
            color: #ffffff;
            font-size: 1rem;
            display: block;
            margin-bottom: 5px;
        }

        .rec-content p {
            color: #a8b5c8;
            font-size: 0.9rem;
            margin: 0;
            line-height: 1.4;
        }

        .sustainability-score {
            background: linear-gradient(135deg, rgba(63, 207, 142, 0.15), rgba(100, 212, 164, 0.08));
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(63, 207, 142, 0.3);
            margin-top: 10px;
        }

        .score-label {
            color: #a8b5c8;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .score-value {
            color: #3fcf8e;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .score-description {
            color: #ffffff;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3fcf8e, #64d4a4);
            border: none;
            border-radius: 50px;
            padding: 15px 35px;
            color: #1a1d2b;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(63, 207, 142, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(63, 207, 142, 0.4);
            background: linear-gradient(135deg, #35b879, #5bc99a);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            padding: 13px 33px;
            color: #ffffff;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-secondary:hover {
            border-color: #3fcf8e;
            color: #3fcf8e;
            text-decoration: none;
            transform: translateY(-2px);
        }

        .language-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .language-select {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            outline: none;
            width: 120px;
            backdrop-filter: blur(10px);
        }
        
        .language-select option {
            background-color: #292d3e;
            color: white;
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .result-card[style*="span 3"] {
                grid-column: span 2 !important;
            }
        }

        @media (max-width: 768px) {
            .results-container {
                padding: 25px;
                width: 98%;
            }
            
            .page-title {
                font-size: 2rem;
                margin-bottom: 2rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr !important;
                gap: 20px;
            }
            
            .result-card[style*="span"] {
                grid-column: span 1 !important;
            }
            
            .eco-equivalences {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .lifecycle-stages {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body id="static">
    <!-- Language Selector -->
    <div class="language-container">
        <select id="language-select" class="language-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="pt">Português</option>
        </select>
    </div>

    <main class="main-bg">
        <video playsinline autoplay muted loop id="backgroundVideo" style="position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%; width: auto; height: auto; z-index: -100; background-size: cover;">
            <source src="assets/video.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div class="mask" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: -99;"></div>

        <div class="results-container">
            <h1 class="page-title" id="results-title">Resultados del Análisis</h1>

            <div class="results-grid">
                <!-- Total Impact Card (Centered) -->
                <div class="result-card" style="grid-column: 2;">
                    <h3 class="card-title">
                        <span class="card-icon">🌱</span>
                        <span id="total-impact-title">Impacto Total</span>
                    </h3>
                    <div class="impact-value" id="total-co2">Calculando...</div>
                    <div class="impact-subtitle">Equivalente de CO₂ total del producto</div>
                </div>

                <!-- Lifecycle Analysis Card -->
                <div class="result-card" style="grid-column: span 3;">
                    <h3 class="card-title">
                        <span class="card-icon">🔄</span>
                        <span id="lifecycle-analysis">Análisis por Etapa del Ciclo de Vida</span>
                    </h3>
                    <div class="lifecycle-stages">
                        <div class="lifecycle-stage">
                            <div class="stage-title" id="production">🏭 Producción</div>
                            <div class="stage-value" id="production-impact">Calculando...</div>
                        </div>
                        <div class="lifecycle-stage">
                            <div class="stage-title" id="transport">🚛 Transporte</div>
                            <div class="stage-value" id="transport-impact">Calculando...</div>
                        </div>
                        <div class="lifecycle-stage">
                            <div class="stage-title" id="usage">📦 Uso</div>
                            <div class="stage-value" id="usage-impact">Calculando...</div>
                        </div>
                        <div class="lifecycle-stage">
                            <div class="stage-title" id="end-of-life">♻️ Fin de Vida</div>
                            <div class="stage-value" id="end-of-life-impact">Calculando...</div>
                        </div>
                    </div>
                </div>

                <!-- Impact Distribution Chart -->
                <div class="result-card">
                    <h3 class="card-title">
                        <span class="card-icon">📊</span>
                        <span id="impact-distribution">Distribución de Impacto</span>
                    </h3>
                    <div class="chart-container">
                        <canvas id="impactChart"></canvas>
                    </div>
                    <div class="chart-description" style="color: #a8b5c8; font-size: 0.95rem; text-align: center; margin-top: 15px; line-height: 1.4;">
                        <strong>Interpretación:</strong> Este gráfico muestra cómo se distribuye el impacto ambiental total a lo largo del ciclo de vida del producto. La <span style="color: #3fcf8e;">producción</span> representa el mayor impacto (60%), seguida del <span style="color: #60a8d8;">transporte</span> y el <span style="color: #d86060;">fin de vida</span> (15% cada uno), mientras que el <span style="color: #d8a860;">uso</span> tiene el menor impacto (10%).
                    </div>
                </div>

                <!-- Comparison Card -->
                <div class="result-card">
                    <h3 class="card-title">
                        <span class="card-icon">⚖️</span>
                        Comparación Ambiental
                    </h3>
                    <div class="comparison-container">
                        <div class="comparison-title">
                            <span>🔴</span>
                            vs. Plástico Convencional
                        </div>
                        <div class="comparison-value" id="comparison-co2">Calculando...</div>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        <div class="comparison-description mt-3" style="color: #a8b5c8; font-size: 1rem; text-align: center;">
                            <strong>Interpretación:</strong> La barra verde representa el impacto ambiental (CO₂) de tu producto eco-friendly, mientras que la barra roja muestra el impacto de una alternativa convencional de plástico. Una barra verde más baja indica un producto más sostenible. El ahorro de emisiones se muestra arriba.
                        </div>
                    </div>
                </div>

                <!-- Sustainability Recommendations Card -->
                <div class="result-card">
                    <h3 class="card-title">
                        <span class="card-icon">🌿</span>
                        <span id="sustainability-recommendations">Recomendaciones de Sostenibilidad</span>
                    </h3>
                    <div class="recommendations-container">
                        <div class="recommendation-item">
                            <div class="rec-icon">♻️</div>
                            <div class="rec-content">
                                <strong>Optimización de Materiales:</strong>
                                <p>Considera reducir el peso de componentes no esenciales para minimizar la huella de carbono.</p>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="rec-icon">🚛</div>
                            <div class="rec-content">
                                <strong>Transporte Eficiente:</strong>
                                <p>Utiliza proveedores locales cuando sea posible para reducir las emisiones de transporte.</p>
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="rec-icon">🏭</div>
                            <div class="rec-content">
                                <strong>Producción Sostenible:</strong>
                                <p>Implementa energías renovables en el proceso de manufactura para mayor impacto positivo.</p>
                            </div>
                        </div>
                        <div class="sustainability-score">
                            <div class="score-label">Índice de Sostenibilidad</div>
                            <div class="score-value" id="sustainability-score">85/100</div>
                            <div class="score-description">¡Excelente elección ecológica!</div>
                        </div>
                    </div>
                </div>

                <!-- Eco-Equivalences Card -->
                <div class="result-card" style="grid-column: span 3;">
                    <h3 class="card-title">
                        <span class="card-icon">🌍</span>
                        Eco-Equivalencias
                    </h3>
                    <div class="impact-subtitle" style="margin-bottom: 25px;">
                        Tu huella de carbono es equivalente a:
                    </div>
                    <div class="eco-equivalences">
                        <div class="equivalence-item">
                            <span class="equivalence-icon">💡</span>
                            <div class="equivalence-value" id="eco-hours">-</div>
                            <div class="equivalence-label">Horas de ampolleta encendida</div>
                        </div>
                        <div class="equivalence-item">
                            <span class="equivalence-icon">🚗</span>
                            <div class="equivalence-value" id="eco-km">- km</div>
                            <div class="equivalence-label">Kilómetros en automóvil</div>
                        </div>
                        <div class="equivalence-item">
                            <span class="equivalence-icon">🚿</span>
                            <div class="equivalence-value" id="eco-shower">- min</div>
                            <div class="equivalence-label">Minutos de ducha caliente</div>
                        </div>
                        <div class="equivalence-item">
                            <span class="equivalence-icon">🗑️</span>
                            <div class="equivalence-value" id="eco-trash">-</div>
                            <div class="equivalence-label">Bolsas de basura doméstica</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn-primary" onclick="generatePDF()" id="download-btn">
                    📄 Descargar Reporte PDF
                </button>
                <a href="calculator.html" class="btn-secondary" id="back-to-calculator">
                    ← Volver a la Calculadora
                </a>
            </div>
        </div>
    </main>

    <script src="js/main.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/language.js"></script>
    <script>
        // Lifecycle stage impact factors (percentage of total impact)
        const lifecycleFactorsResults = {
            production: 0.6,    // 60% of total impact
            transport: 0.15,    // 15% of total impact
            usage: 0.1,         // 10% of total impact
            endOfLife: 0.15     // 15% of total impact
        };

        // Chart instances to track and destroy
        let impactChartInstance = null;
        let comparisonChartInstance = null;

        function calculateLifecycleImpacts(totalCO2, totalEnergy, totalWater, totalWaste) {
            return {
                production: {
                    co2: totalCO2 * lifecycleFactorsResults.production
                },
                transport: {
                    co2: totalCO2 * lifecycleFactorsResults.transport
                },
                usage: {
                    co2: totalCO2 * lifecycleFactorsResults.usage
                },
                endOfLife: {
                    co2: totalCO2 * lifecycleFactorsResults.endOfLife
                }
            };
        }

        function updateResults() {
            try {
                const data = JSON.parse(localStorage.getItem('packagingComponents') || '{"components": [], "productionVolume": 1}');
                const componentsData = data.components;
                const productionVolume = data.productionVolume;
                let totalCO2 = 0;
                let totalCO2_conventional = 0;
                
                componentsData.forEach(component => {
                    const impact = materialImpacts[component.material];
                    if (impact) {
                        const weight = component.weight;
                        totalCO2 += impact.co2 * weight;
                        // Para comparación: si es biobasado, usar 1.6x su valor; si es convencional, usar su propio valor
                        if (["bioe8i-resin","bioe8i-film","bioe8i-laminado","pla","pbat","pha"].includes(component.material)) {
                            totalCO2_conventional += (impact.co2 * 1.6) * weight;
                        } else {
                            totalCO2_conventional += impact.co2 * weight;
                        }
                    }
                });
                totalCO2 *= productionVolume;
                totalCO2_conventional *= productionVolume;
                
                // Update product name in title if available
                const productName = data.productName;
                const titleElement = document.getElementById('results-title');
                if (titleElement && productName) {
                    titleElement.textContent = `Resultados: ${productName}`;
                }
                
                // Show total impact
                const totalCO2Element = document.getElementById('total-co2');
                if (totalCO2Element) {
                    totalCO2Element.textContent = `${totalCO2.toFixed(2)} kg CO₂`;
                }
                
                // Show comparison
                const comparisonElement = document.getElementById('comparison-co2');
                if (comparisonElement) {
                    const savings = totalCO2_conventional - totalCO2;
                    const savingsPercent = ((savings / totalCO2_conventional) * 100).toFixed(1);
                    comparisonElement.innerHTML = `
                        <strong>${totalCO2_conventional.toFixed(2)} kg CO₂</strong><br>
                        <span style="color: #3fcf8e;">Ahorras ${savings.toFixed(2)} kg CO₂ (${savingsPercent}%)</span>
                    `;
                }
                
                // Update equivalences with animation
                const equivalences = [
                    { id: 'eco-hours', value: (totalCO2 * 16.66).toFixed(1), suffix: ' h' },
                    { id: 'eco-km', value: (totalCO2 * 8.34).toFixed(1), suffix: ' km' },
                    { id: 'eco-shower', value: (totalCO2 * 4).toFixed(1), suffix: ' min' },
                    { id: 'eco-trash', value: (totalCO2 * 2).toFixed(1), suffix: '' }
                ];
                
                equivalences.forEach(eq => {
                    const element = document.getElementById(eq.id);
                    if (element) {
                        element.textContent = eq.value + eq.suffix;
                    }
                });

                // Calculate lifecycle impacts
                const lifecycleImpacts = calculateLifecycleImpacts(totalCO2, 0, 0, 0);

                // Update lifecycle stages
                const stages = [
                    { id: 'production-impact', value: lifecycleImpacts.production.co2 },
                    { id: 'transport-impact', value: lifecycleImpacts.transport.co2 },
                    { id: 'usage-impact', value: lifecycleImpacts.usage.co2 },
                    { id: 'end-of-life-impact', value: lifecycleImpacts.endOfLife.co2 }
                ];
                
                stages.forEach(stage => {
                    const element = document.getElementById(stage.id);
                    if (element) {
                        element.textContent = `${stage.value.toFixed(2)} kg CO₂`;
                    }
                });

                // Update sustainability score
                updateSustainabilityScore(totalCO2, totalCO2_conventional, componentsData);

                // Create charts with better styling - destroy existing charts first
                createImpactChart();
                createComparisonChart(totalCO2, totalCO2_conventional);
                
            } catch (error) {
                console.error('Error updating results:', error);
                // Show error state
                const elements = ['total-co2', 'comparison-co2'];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = 'Error al calcular';
                        element.style.color = '#d86060';
                    }
                });
            }
        }

        function updateSustainabilityScore(currentCO2, conventionalCO2, components) {
            // Calculate sustainability score based on multiple factors
            let score = 50; // Base score
            
            // Factor 1: CO2 reduction vs conventional (max 30 points)
            const reductionPercent = ((conventionalCO2 - currentCO2) / conventionalCO2) * 100;
            score += Math.min(30, reductionPercent * 0.6);
            
            // Factor 2: Use of bio-based materials (max 25 points)
            const bioBasedMaterials = components.filter(c => 
                ["bioe8i-resin","bioe8i-film","bioe8i-laminado","pla","pbat","pha"].includes(c.material)
            );
            const bioBasedRatio = bioBasedMaterials.length / components.length;
            score += bioBasedRatio * 25;
            
            // Factor 3: Total impact level (max 15 points - lower is better)
            if (currentCO2 < 0.5) score += 15;
            else if (currentCO2 < 1.0) score += 10;
            else if (currentCO2 < 2.0) score += 5;
            
            // Cap the score at 100
            score = Math.min(100, Math.round(score));
            
            // Update score display
            const scoreElement = document.getElementById('sustainability-score');
            if (scoreElement) {
                scoreElement.textContent = `${score}/100`;
            }
            
            // Update description based on score
            const descElement = document.querySelector('.score-description');
            if (descElement) {
                if (score >= 85) {
                    descElement.textContent = '¡Excelente elección ecológica!';
                    descElement.style.color = '#3fcf8e';
                } else if (score >= 70) {
                    descElement.textContent = 'Buena opción sostenible';
                    descElement.style.color = '#64d4a4';
                } else if (score >= 50) {
                    descElement.textContent = 'Opción moderadamente sostenible';
                    descElement.style.color = '#d8a860';
                } else {
                    descElement.textContent = 'Hay oportunidades de mejora';
                    descElement.style.color = '#d86060';
                }
            }
        }

        function createImpactChart() {
            const impactCanvas = document.getElementById('impactChart');
            if (impactCanvas) {
                // Destroy existing chart
                if (impactChartInstance) {
                    impactChartInstance.destroy();
                }
                
                // Set high DPI for better quality
                const ctx = impactCanvas.getContext('2d');
                ctx.canvas.style.width = '100%';
                ctx.canvas.style.height = '100%';
                
                impactChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Producción', 'Transporte', 'Uso', 'Fin de Vida'],
                        datasets: [{
                            data: [60, 15, 10, 15],
                            backgroundColor: [
                                '#3fcf8e',
                                '#60a8d8',
                                '#d8a860',
                                '#d86060'
                            ],
                            borderWidth: 2,
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            hoverOffset: 10,
                            hoverBorderWidth: 3,
                            hoverBorderColor: 'rgba(255, 255, 255, 0.3)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        devicePixelRatio: window.devicePixelRatio || 2,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: 'white',
                                    font: {
                                        size: 13,
                                        family: 'Inter',
                                        weight: '500'
                                    },
                                    padding: 20,
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(23, 26, 39, 0.95)',
                                titleColor: '#ffffff',
                                bodyColor: '#a8b5c8',
                                borderColor: 'rgba(63, 207, 142, 0.5)',
                                borderWidth: 1,
                                cornerRadius: 8,
                                displayColors: true,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        return `${label}: ${value}%`;
                                    }
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'nearest'
                        }
                    }
                });
            }
        }

        function createComparisonChart(current, conventional) {
            const comparisonCanvas = document.getElementById('comparisonChart');
            if (comparisonCanvas) {
                if (comparisonChartInstance) {
                    comparisonChartInstance.destroy();
                }
                
                // Set high DPI for better quality
                const ctx = comparisonCanvas.getContext('2d');
                ctx.canvas.style.width = '100%';
                ctx.canvas.style.height = '100%';
                
                comparisonChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Tu Producto', 'Convencional'],
                        datasets: [{
                            data: [current, conventional],
                            backgroundColor: [
                                'rgba(63, 207, 142, 0.9)',
                                'rgba(216, 96, 96, 0.9)'
                            ],
                            borderColor: [
                                '#3fcf8e',
                                '#d86060'
                            ],
                            borderWidth: 2,
                            borderRadius: {
                                topLeft: 8,
                                topRight: 8,
                                bottomLeft: 0,
                                bottomRight: 0
                            },
                            hoverBackgroundColor: [
                                'rgba(63, 207, 142, 1)',
                                'rgba(216, 96, 96, 1)'
                            ],
                            hoverBorderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        devicePixelRatio: window.devicePixelRatio || 2,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(23, 26, 39, 0.95)',
                                titleColor: '#ffffff',
                                bodyColor: '#a8b5c8',
                                borderColor: 'rgba(63, 207, 142, 0.5)',
                                borderWidth: 1,
                                cornerRadius: 8,
                                displayColors: true,
                                callbacks: {
                                    title: function(context) {
                                        return context[0].label;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.y;
                                        return `Emisiones: ${value.toFixed(2)} kg CO₂`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Emisiones CO₂ (kg)',
                                    color: '#ffffff',
                                    font: { 
                                        family: 'Inter',
                                        size: 12,
                                        weight: '500'
                                    }
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.8)',
                                    font: { 
                                        family: 'Inter',
                                        size: 11
                                    }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.15)',
                                    lineWidth: 1
                                }
                            },
                            x: {
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.8)',
                                    font: { 
                                        family: 'Inter',
                                        size: 11,
                                        weight: '500'
                                    }
                                },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'nearest'
                        }
                    }
                });
            }
        }

        function generatePDF() {
            alert('Función de generación de PDF en desarrollo');
        }

        // Initialize results when page loads
        document.addEventListener('DOMContentLoaded', updateResults);
    </script>
</body>
</html> 